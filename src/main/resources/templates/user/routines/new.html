<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<div th:replace="~{fragment :: meta}"></div>
	<div th:replace="~{fragment :: styles}"></div>
<title>ルーティン新規登録</title>
</head>
<body>
	<div class="goalplanningapp-wrapper">
		<div th:replace="~{fragment :: header}"></div>
		<main>
			<div class="container pt-4 pb-5 goalplanningapp-container">
				<div class="row justify-content-center">
					<div class="col-xl-10 col-lg-11 col-md-12">
						<h1 class="mb-4 text-center">ルーティン新規登録</h1>
						<form th:action="@{/routines}" method="post" th:object="${routineForm}">
							<table>
								<thead>
									<tr>
										<th>項目</th>
										<th>開始</th>
										<th>終了</th>
										<th>曜日</th>
									</tr>									
								</thead>
								<tbody>
<th:block th:each="row, stat : *{rows}">

    <tr>
        <!-- ===== 項目名 ===== -->
        <td>
            <span th:text="${row.title == '睡眠' ? row.sleepType : row.title}"></span>

            <!-- title は必ず送信 -->
            <input type="hidden"
                   th:field="*{rows[__${stat.index}__].title}" />

            <!-- sleepType は睡眠のときだけ送信 -->
            <input type="hidden"
                   th:if="${row.title == '睡眠'}"
                   th:field="*{rows[__${stat.index}__].sleepType}" />
        </td>

        <!-- ===== 開始 ===== -->
        <td>
            <!-- 通常ルーティン -->
            <input type="time"
                   th:if="${row.title != '睡眠'}"
                   th:field="*{rows[__${stat.index}__].startTime}" />

            <!-- 睡眠：就寝 -->
            <input type="time"
                   th:if="${row.title == '睡眠' and row.sleepType == '就寝'}"
                   th:field="*{rows[__${stat.index}__].startTime}" />
        </td>

        <!-- ===== 終了 ===== -->
        <td>
            <!-- 通常ルーティン -->
            <input type="time"
                   th:if="${row.title != '睡眠'}"
                   th:field="*{rows[__${stat.index}__].endTime}" />

            <!-- 睡眠：起床 -->
            <input type="time"
                   th:if="${row.title == '睡眠' and row.sleepType == '起床'}"
                   th:field="*{rows[__${stat.index}__].endTime}" />
        </td>

        <!-- ===== 曜日 ===== -->
        <td>
            <label th:each="day : ${days}">
                <input type="checkbox"
                       th:field="*{rows[__${stat.index}__].days}"
                       th:value="${day}" />
                <span th:text="${day.label}"></span>
            </label>
        </td>
    </tr>

	
	
<!--
     ===== 睡眠：起床 =====
    <tr th:if="${row != null and row.title == '睡眠'}">
        <td>
            起床
            <input type="hidden"
                   th:field="*{rows[__${stat.index}__].title}" />
        </td>
        <td>
            <input type="time"
                   th:field="*{rows[__${stat.index}__].endTime}" />
        </td>
        <td></td>
        <td>
            <label th:each="day : ${days}">
                <input type="checkbox"
                       th:field="*{rows[__${stat.index}__].days}"
                       th:value="${day}" />
                <span th:text="${day.label}"></span>
            </label>
        </td>
    </tr>
    ===== 通常ルーティン =====
    <tr th:if="${row != null and row.title != '睡眠'}">
        <td>
            <span th:text="${row.title}"></span>
            <input type="hidden"
                   th:field="*{rows[__${stat.index}__].title}" />
        </td>
        <td>
            <input type="time"
                   th:field="*{rows[__${stat.index}__].startTime}" />
        </td>
        <td>
            <input type="time"
                   th:field="*{rows[__${stat.index}__].endTime}" />
        </td>
        <td>
            <label th:each="day : ${days}">
                <input type="checkbox"
                       th:field="*{rows[__${stat.index}__].days}"
                       th:value="${day}" />
                <span th:text="${day.label}"></span>
            </label>
        </td>
    </tr>
        ===== 睡眠：就寝 =====
	<tr th:if="${row != null and row.title == '睡眠'}">
    	<td>就寝</td>
    	<td>
        	<input type="time"
            	   th:field="*{rows[__${stat.index}__].startTime}" />
	    </td>
    	<td></td>
    	<td>
        	<label th:each="day : ${days}">
            	<input type="checkbox"
                	   th:field="*{rows[__${stat.index}__].days}"
                   	th:value="${day}" />
        	    <span th:text="${day.label}"></span>
     	   </label>
   		</td>
	</tr>
</th:block>
-->
								</tbody>
							</table>
							<!-- 送信 -->
							<div>
								<button type="submit">まとめて登録</button>							
							</div>
						</form>
					</div>
				</div>
			</div>
		</main>
		<div th:replace="~{fragment :: footer}"></div>
	</div>
	<div th:replace="~{fragment :: scripts}"></div>
</body>
</html>